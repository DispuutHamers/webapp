# This is a sample build configuration for Ruby.
# Check our guides at https://confluence.atlassian.com/x/VYk8Lw for more examples.
# Only use spaces to indent your .yml configuration.
# -----
# You can specify a custom docker image from Docker Hub as your build environment.
image: ruby:2.5.0

pipelines:
  default:
    - step:
        cache: 
          - bundler
        script: # Modify the commands below to build your repository.
          - apt-get update && apt-get install -y locales
          - echo "en_US.UTF-8 UTF-8" > /etc/locale.gen
          - locale-gen
          - export LANG=en_US.UTF-8
          - export LANGUAGE=en_US.UTF-8
          - export LC_ALL=en_US.UTF-8
          - gem install bundler
          - bundle install --path vendor/bundle
          - rails db:create
          - rails test test/models/*
        services:
            - database

definitions:
  caches:
    bundler: vendor/bundle
  services:
    database:
      image: mysql
      environment:
        MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
